'use strict';

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

var fs = require('fs');
var path = require('path');

Object.assign.apply(Object, [exports, fs].concat(_toConsumableArray(['access', 'appendFile', 'chmod', 'chown', 'close', 'exists', 'fchmod', 'fchown', 'fdatasync', 'fstat', 'fsync', 'ftruncate', 'futimes', 'lchmod', 'lchown', 'link', 'lstat', 'mkdtemp', 'open', 'read', 'readdir', 'readFile', 'readlink', 'realpath', 'rename', 'rmdir', 'stat', 'symlink', 'truncate', 'unlink', 'utimes', 'write', 'write'].map(function (name) {
	return _defineProperty({}, name, function (pathname) {
		for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
			args[_key - 1] = arguments[_key];
		}

		return new Promise(function (resolve, reject) {
			return fs[name].apply(fs, [pathname].concat(args, [function (err) {
				for (var _len2 = arguments.length, res = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
					res[_key2 - 1] = arguments[_key2];
				}

				if (err) {
					reject(err);
				} else {
					resolve.apply(undefined, res);
				}
			}]));
		});
	});
})), _toConsumableArray(['mkdir', 'writeFile'].map(function (key) {
	return _defineProperty({}, key, function (pathname) {
		for (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
			args[_key3 - 1] = arguments[_key3];
		}

		return new Promise(function (resolve, reject) {
			// execute the native method
			fs[key].apply(fs, [pathname].concat(args, [function (err) {
				// if there is no parent directory
				if (err && err.code === 'ENOENT') {
					// promise to make the parent directory
					exports.mkdir(path.dirname(pathname)).then(
					// and then try again
					function () {
						var _exports;

						return (_exports = exports)[key].apply(_exports, [pathname].concat(args));
					}).then(resolve);
				} else if (err && err.code !== 'EEXIST') {
					// otherwise, reject any error not about an existing directory
					reject(err);
				} else {
					// otherwise, resolve
					resolve();
				}
			}]));
		});
	});
})), _toConsumableArray(['mkdirSync', 'writeFileSync'].map(function (key) {
	return _defineProperty({}, key, function (pathname) {
		for (var _len4 = arguments.length, args = Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {
			args[_key4 - 1] = arguments[_key4];
		}

		try {
			// try to execute the native method
			fs[key].apply(fs, [pathname].concat(args));
		} catch (err) {
			// if there is no parent directory
			if (err && err.code === 'ENOENT') {
				var _exports2;

				// make the parent directory
				exports.mkdirSync(path.dirname(pathname));

				// and then try again
				(_exports2 = exports)[key].apply(_exports2, [pathname].concat(args));
			} else if (err && err.code !== 'EEXIST') {
				// otherwise, throw any error not about an existing directory
				throw err;
			}
		}
	});
})), [

// copydir
{
	copydir: function copydir(source, target) {
		return exports.mkdir(target).then(
		// make the target directory, then promise to read the source directory
		function () {
			return exports.readdir(source);
		}).then(
		// promise to copy the contents of the source directory
		function (children) {
			return Promise.all(children.map(function (child) {
				var sourceChild = path.resolve(source, child);
				var targetChild = path.resolve(target, child);

				// promise the appropriate copy of the child
				return exports.lstat(sourceChild).then(function (lstat) {
					return lstat.isDirectory() ? exports.copydir(sourceChild, targetChild) : exports.copyFile(sourceChild, targetChild);
				});
			})).then(function () {
				return Promise.resolve();
			});
		});
	}
},

// copydirSync
{
	copydirSync: function copydirSync(source, target) {
		// make the target directory
		exports.mkdirSync(target);

		// read the source directory
		var children = exports.readdirSync(source);

		// copy the contents of the source directory
		children.forEach(function (child) {
			var sourceChild = path.resolve(source, child);
			var targetChild = path.resolve(target, child);

			var lstat = exports.lstatSync(sourceChild);

			// execute the appropriate copy of the child
			if (lstat.isDirectory()) {
				exports.copydirSync(sourceChild, targetChild);
			} else {
				exports.copyFileSync(sourceChild, targetChild);
			}
		});
	}
},

// copyFile
{
	copyFile: function copyFile(source, target) {
		return exports.touchFile(target).then(
		// make the target directory, then promise to copy the file
		function () {
			return new Promise(function (resolve, reject) {
				// create streams
				var readStream = exports.createReadStream(path.resolve(source));
				var writeStream = exports.createWriteStream(path.resolve(target));

				// reject on read error
				readStream.on('error', prereject);

				// reject on write error
				writeStream.on('error', prereject);

				// resolve on finish
				writeStream.on('finish', resolve);

				// copy stream
				readStream.pipe(writeStream);

				function prereject(err) {
					// destroy streams
					readStream.destroy();
					writeStream.end();

					// reject with error
					reject(err);
				}
			});
		});
	}
},

// copyFileSync
{
	copyFileSync: function copyFileSync(source, target) {
		// make the target directory
		exports.mkdirSync(path.dirname(target));

		// buffer
		var bufferLength = 64 * 1024;
		var buffer = new Buffer(bufferLength);

		// position
		var bytesRead = 1;
		var position = 0;

		// open the reader and writer
		var reader = fs.openSync(source, 'r');
		var writer = fs.openSync(target, 'w');

		// copy the file
		while (bytesRead > 0) {
			bytesRead = fs.readSync(reader, buffer, 0, bufferLength, position);

			fs.writeSync(writer, buffer, 0, bytesRead);

			position += bytesRead;
		}

		// close the reader and writer
		fs.closeSync(reader);
		fs.closeSync(writer);
	}
},

// readJson
{
	readJson: function readJson(filename) {
		return exports.readFile(filename, 'utf8').then(JSON.parse);
	}
},

// readJsonSync
{
	readJsonSync: function readJsonSync(filename) {
		return JSON.parse(exports.readFileSync(filename, 'utf8'));
	}
},

// rmdir
{
	rmdir: function rmdir(dirname) {
		return new Promise(function (resolve, reject) {
			// remove the directory
			fs.rmdir(dirname, function (err) {
				// if there is an error about the directory not being empty
				if (err && err.code === 'ENOTEMPTY') {
					// resolve to read the directory
					resolve(exports.readdir(dirname).then(
					// promise to remove each child of the directory
					function (children) {
						return Promise.all(children.map(function (child) {
							var resolvedChild = path.resolve(dirname, child);

							// promise to remove of the child
							return exports.lstat(resolvedChild).then(function (lstat) {
								return lstat.isDirectory() ? exports.rmdir(resolvedChild) : exports.unlink(resolvedChild);
							});
						}));
					}).then(
					// and then try again
					function () {
						return exports.rmdir(dirname);
					}));
				} else if (err) {
					// otherwise, reject any error
					reject(err);
				} else {
					// otherwise, resolve
					resolve();
				}
			});
		});
	}
},

// rmdirSync
{
	rmdirSync: function rmdirSync(dirname) {
		try {
			// try to remove the directory
			fs.rmdirSync(dirname);
		} catch (err) {
			// if there is an error about the directory not being empty
			if (err && err.code === 'ENOTEMPTY') {
				var children = exports.readdirSync(dirname);

				// remove each child of the directory
				children.forEach(function (child) {
					var resolvedChild = path.resolve(dirname, child);

					var lstat = exports.lstatSync(resolvedChild);

					// remove the child
					if (lstat.isDirectory()) {
						exports.rmdirSync(resolvedChild);
					} else {
						exports.unlinkSync(resolvedChild);
					}
				});

				// and then try again
				exports.rmdirSync(dirname);
			} else {
				// otherwise, throw any error
				throw err;
			}
		}
	}
},

// touchFile
{
	touchFile: function touchFile(filename) {
		return new Promise(function (resolve, reject) {
			// touch the file
			fs.open(filename, 'wx', function (err) {
				// if there is no parent directory
				if (err && err.code === 'ENOENT') {
					// promise to make the parent directory
					exports.mkdir(path.dirname(filename)).then(
					// and then try again
					function () {
						return exports.touchFile(filename);
					}).then(resolve);
				} else if (err && err.code !== 'EEXIST') {
					// otherwise, reject any error not about the directory already existing
					reject(err);
				} else {
					// otherwise, resolve
					resolve();
				}
			});
		});
	}
},

// touchFileSync
{
	touchFileSync: function touchFileSync(filename) {
		try {
			// try to touch the file
			fs.openSync(filename, 'wx');
		} catch (err) {
			// if there is no parent directory
			if (err && err.code === 'ENOENT') {
				// make the parent directory
				exports.mkdirSync(path.dirname(filename));

				// and then try again
				exports.touchFileSync(filename);
			} else if (err && err.code !== 'EEXIST') {
				// otherwise, throw any error not about the directory already existing
				throw err;
			}
		}
	}
}]));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QztBQUNqQztBQUNBLFlBQVEsU0FBUixDQUFrQixLQUFLLE9BQUwsQ0FBYSxRQUFiLENBQWxCOztBQUVBO0FBQ0EsWUFBUSxhQUFSLENBQXNCLFFBQXRCO0FBQ0EsSUFORCxNQU1PLElBQUksT0FBTyxJQUFJLElBQUosS0FBYSxRQUF4QixFQUFrQztBQUN4QztBQUNBLFVBQU0sR0FBTjtBQUNBO0FBQ0Q7QUFDRDtBQWxCRixDQTdWRCIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGZzICAgPSByZXF1aXJlKCdmcycpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcblxuT2JqZWN0LmFzc2lnbihcblx0ZXhwb3J0cyxcblx0ZnMsXG5cdC4uLltcblx0XHQnYWNjZXNzJyxcblx0XHQnYXBwZW5kRmlsZScsXG5cdFx0J2NobW9kJyxcblx0XHQnY2hvd24nLFxuXHRcdCdjbG9zZScsXG5cdFx0J2V4aXN0cycsXG5cdFx0J2ZjaG1vZCcsXG5cdFx0J2ZjaG93bicsXG5cdFx0J2ZkYXRhc3luYycsXG5cdFx0J2ZzdGF0Jyxcblx0XHQnZnN5bmMnLFxuXHRcdCdmdHJ1bmNhdGUnLFxuXHRcdCdmdXRpbWVzJyxcblx0XHQnbGNobW9kJyxcblx0XHQnbGNob3duJyxcblx0XHQnbGluaycsXG5cdFx0J2xzdGF0Jyxcblx0XHQnbWtkdGVtcCcsXG5cdFx0J29wZW4nLFxuXHRcdCdyZWFkJyxcblx0XHQncmVhZGRpcicsXG5cdFx0J3JlYWRGaWxlJyxcblx0XHQncmVhZGxpbmsnLFxuXHRcdCdyZWFscGF0aCcsXG5cdFx0J3JlbmFtZScsXG5cdFx0J3JtZGlyJyxcblx0XHQnc3RhdCcsXG5cdFx0J3N5bWxpbmsnLFxuXHRcdCd0cnVuY2F0ZScsXG5cdFx0J3VubGluaycsXG5cdFx0J3V0aW1lcycsXG5cdFx0J3dyaXRlJyxcblx0XHQnd3JpdGUnXG5cdF0ubWFwKFxuXHRcdG5hbWUgPT4gKHtcblx0XHRcdFtuYW1lXTogKHBhdGhuYW1lLCAuLi5hcmdzKSA9PiBuZXcgUHJvbWlzZShcblx0XHRcdFx0KHJlc29sdmUsIHJlamVjdCkgPT4gZnNbbmFtZV0ocGF0aG5hbWUsIC4uLmFyZ3MsXG5cdFx0XHRcdFx0KGVyciwgLi4ucmVzKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0cmVzb2x2ZSguLi5yZXMpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0KVxuXHRcdFx0KVxuXHRcdH0pXG5cdCksXG5cblx0Ly8gbWtkaXIgKyB3cml0ZUZpbGVcblx0Li4uWydta2RpcicsICd3cml0ZUZpbGUnXS5tYXAoXG5cdFx0a2V5ID0+ICh7XG5cdFx0XHRba2V5XTogKHBhdGhuYW1lLCAuLi5hcmdzKSA9PiBuZXcgUHJvbWlzZShcblx0XHRcdFx0KHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0XHRcdC8vIGV4ZWN1dGUgdGhlIG5hdGl2ZSBtZXRob2Rcblx0XHRcdFx0XHRmc1trZXldKFxuXHRcdFx0XHRcdFx0cGF0aG5hbWUsXG5cdFx0XHRcdFx0XHQuLi5hcmdzLFxuXHRcdFx0XHRcdFx0KGVycikgPT4ge1xuXHRcdFx0XHRcdFx0XHQvLyBpZiB0aGVyZSBpcyBubyBwYXJlbnQgZGlyZWN0b3J5XG5cdFx0XHRcdFx0XHRcdGlmIChlcnIgJiYgZXJyLmNvZGUgPT09ICdFTk9FTlQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0Ly8gcHJvbWlzZSB0byBtYWtlIHRoZSBwYXJlbnQgZGlyZWN0b3J5XG5cdFx0XHRcdFx0XHRcdFx0ZXhwb3J0cy5ta2RpcihwYXRoLmRpcm5hbWUocGF0aG5hbWUpKS50aGVuKFxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gYW5kIHRoZW4gdHJ5IGFnYWluXG5cdFx0XHRcdFx0XHRcdFx0XHQoKSA9PiBleHBvcnRzW2tleV0ocGF0aG5hbWUsIC4uLmFyZ3MpXG5cdFx0XHRcdFx0XHRcdFx0KS50aGVuKHJlc29sdmUpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKGVyciAmJiBlcnIuY29kZSAhPT0gJ0VFWElTVCcpIHtcblx0XHRcdFx0XHRcdFx0XHQvLyBvdGhlcndpc2UsIHJlamVjdCBhbnkgZXJyb3Igbm90IGFib3V0IGFuIGV4aXN0aW5nIGRpcmVjdG9yeVxuXHRcdFx0XHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdC8vIG90aGVyd2lzZSwgcmVzb2x2ZVxuXHRcdFx0XHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdH1cblx0XHRcdClcblx0XHR9KVxuXHQpLFxuXG5cdC8vIG1rZGlyU3luYywgd3JpdGVGaWxlU3luY1xuXHQuLi5bJ21rZGlyU3luYycsICd3cml0ZUZpbGVTeW5jJ10ubWFwKFxuXHRcdGtleSA9PiAoe1xuXHRcdFx0W2tleV06IChwYXRobmFtZSwgLi4uYXJncykgPT4ge1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdC8vIHRyeSB0byBleGVjdXRlIHRoZSBuYXRpdmUgbWV0aG9kXG5cdFx0XHRcdFx0ZnNba2V5XShwYXRobmFtZSwgLi4uYXJncyk7XG5cdFx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0XHRcdC8vIGlmIHRoZXJlIGlzIG5vIHBhcmVudCBkaXJlY3Rvcnlcblx0XHRcdFx0XHRpZiAoZXJyICYmIGVyci5jb2RlID09PSAnRU5PRU5UJykge1xuXHRcdFx0XHRcdFx0Ly8gbWFrZSB0aGUgcGFyZW50IGRpcmVjdG9yeVxuXHRcdFx0XHRcdFx0ZXhwb3J0cy5ta2RpclN5bmMocGF0aC5kaXJuYW1lKHBhdGhuYW1lKSk7XG5cblx0XHRcdFx0XHRcdC8vIGFuZCB0aGVuIHRyeSBhZ2FpblxuXHRcdFx0XHRcdFx0ZXhwb3J0c1trZXldKHBhdGhuYW1lLCAuLi5hcmdzKVxuXHRcdFx0XHRcdH0gZWxzZSBpZiAoZXJyICYmIGVyci5jb2RlICE9PSAnRUVYSVNUJykge1xuXHRcdFx0XHRcdFx0Ly8gb3RoZXJ3aXNlLCB0aHJvdyBhbnkgZXJyb3Igbm90IGFib3V0IGFuIGV4aXN0aW5nIGRpcmVjdG9yeVxuXHRcdFx0XHRcdFx0dGhyb3cgZXJyO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pXG5cdCksXG5cblx0Ly8gY29weWRpclxuXHR7XG5cdFx0Y29weWRpcjogKHNvdXJjZSwgdGFyZ2V0KSA9PiBleHBvcnRzLm1rZGlyKHRhcmdldCkudGhlbihcblx0XHRcdC8vIG1ha2UgdGhlIHRhcmdldCBkaXJlY3RvcnksIHRoZW4gcHJvbWlzZSB0byByZWFkIHRoZSBzb3VyY2UgZGlyZWN0b3J5XG5cdFx0XHQoKSA9PiBleHBvcnRzLnJlYWRkaXIoc291cmNlKVxuXHRcdCkudGhlbihcblx0XHRcdC8vIHByb21pc2UgdG8gY29weSB0aGUgY29udGVudHMgb2YgdGhlIHNvdXJjZSBkaXJlY3Rvcnlcblx0XHRcdGNoaWxkcmVuID0+IFByb21pc2UuYWxsKFxuXHRcdFx0XHRjaGlsZHJlbi5tYXAoXG5cdFx0XHRcdFx0Y2hpbGQgPT4ge1xuXHRcdFx0XHRcdFx0Y29uc3Qgc291cmNlQ2hpbGQgPSBwYXRoLnJlc29sdmUoc291cmNlLCBjaGlsZCk7XG5cdFx0XHRcdFx0XHRjb25zdCB0YXJnZXRDaGlsZCA9IHBhdGgucmVzb2x2ZSh0YXJnZXQsIGNoaWxkKTtcblxuXHRcdFx0XHRcdFx0Ly8gcHJvbWlzZSB0aGUgYXBwcm9wcmlhdGUgY29weSBvZiB0aGUgY2hpbGRcblx0XHRcdFx0XHRcdHJldHVybiBleHBvcnRzLmxzdGF0KHNvdXJjZUNoaWxkKS50aGVuKFxuXHRcdFx0XHRcdFx0XHRsc3RhdCA9PiBsc3RhdC5pc0RpcmVjdG9yeSgpXG5cdFx0XHRcdFx0XHRcdFx0PyBleHBvcnRzLmNvcHlkaXIoc291cmNlQ2hpbGQsIHRhcmdldENoaWxkKVxuXHRcdFx0XHRcdFx0XHQ6IGV4cG9ydHMuY29weUZpbGUoc291cmNlQ2hpbGQsIHRhcmdldENoaWxkKVxuXHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdClcblx0XHRcdCkudGhlbihcblx0XHRcdFx0KCkgPT4gUHJvbWlzZS5yZXNvbHZlKClcblx0XHRcdClcblx0XHQpXG5cdH0sXG5cblx0Ly8gY29weWRpclN5bmNcblx0e1xuXHRcdGNvcHlkaXJTeW5jOiAoc291cmNlLCB0YXJnZXQpID0+IHtcblx0XHRcdC8vIG1ha2UgdGhlIHRhcmdldCBkaXJlY3Rvcnlcblx0XHRcdGV4cG9ydHMubWtkaXJTeW5jKHRhcmdldCk7XG5cblx0XHRcdC8vIHJlYWQgdGhlIHNvdXJjZSBkaXJlY3Rvcnlcblx0XHRcdGNvbnN0IGNoaWxkcmVuID0gZXhwb3J0cy5yZWFkZGlyU3luYyhzb3VyY2UpXG5cblx0XHRcdC8vIGNvcHkgdGhlIGNvbnRlbnRzIG9mIHRoZSBzb3VyY2UgZGlyZWN0b3J5XG5cdFx0XHRjaGlsZHJlbi5mb3JFYWNoKFxuXHRcdFx0XHRjaGlsZCA9PiB7XG5cdFx0XHRcdFx0Y29uc3Qgc291cmNlQ2hpbGQgPSBwYXRoLnJlc29sdmUoc291cmNlLCBjaGlsZCk7XG5cdFx0XHRcdFx0Y29uc3QgdGFyZ2V0Q2hpbGQgPSBwYXRoLnJlc29sdmUodGFyZ2V0LCBjaGlsZCk7XG5cblx0XHRcdFx0XHRjb25zdCBsc3RhdCA9IGV4cG9ydHMubHN0YXRTeW5jKHNvdXJjZUNoaWxkKTtcblxuXHRcdFx0XHRcdC8vIGV4ZWN1dGUgdGhlIGFwcHJvcHJpYXRlIGNvcHkgb2YgdGhlIGNoaWxkXG5cdFx0XHRcdFx0aWYgKGxzdGF0LmlzRGlyZWN0b3J5KCkpIHtcblx0XHRcdFx0XHRcdGV4cG9ydHMuY29weWRpclN5bmMoc291cmNlQ2hpbGQsIHRhcmdldENoaWxkKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0ZXhwb3J0cy5jb3B5RmlsZVN5bmMoc291cmNlQ2hpbGQsIHRhcmdldENoaWxkKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdCk7XG5cdFx0fVxuXHR9LFxuXG5cdC8vIGNvcHlGaWxlXG5cdHtcblx0XHRjb3B5RmlsZTogKHNvdXJjZSwgdGFyZ2V0KSA9PiBleHBvcnRzLnRvdWNoRmlsZSh0YXJnZXQpLnRoZW4oXG5cdFx0XHQvLyBtYWtlIHRoZSB0YXJnZXQgZGlyZWN0b3J5LCB0aGVuIHByb21pc2UgdG8gY29weSB0aGUgZmlsZVxuXHRcdFx0KCkgPT4gbmV3IFByb21pc2UoXG5cdFx0XHRcdChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHRcdFx0XHQvLyBjcmVhdGUgc3RyZWFtc1xuXHRcdFx0XHRcdGNvbnN0IHJlYWRTdHJlYW0gID0gZXhwb3J0cy5jcmVhdGVSZWFkU3RyZWFtKHBhdGgucmVzb2x2ZShzb3VyY2UpKTtcblx0XHRcdFx0XHRjb25zdCB3cml0ZVN0cmVhbSA9IGV4cG9ydHMuY3JlYXRlV3JpdGVTdHJlYW0ocGF0aC5yZXNvbHZlKHRhcmdldCkpO1xuXG5cdFx0XHRcdFx0Ly8gcmVqZWN0IG9uIHJlYWQgZXJyb3Jcblx0XHRcdFx0XHRyZWFkU3RyZWFtLm9uKCdlcnJvcicsIHByZXJlamVjdCk7XG5cblx0XHRcdFx0XHQvLyByZWplY3Qgb24gd3JpdGUgZXJyb3Jcblx0XHRcdFx0XHR3cml0ZVN0cmVhbS5vbignZXJyb3InLCBwcmVyZWplY3QpO1xuXG5cdFx0XHRcdFx0Ly8gcmVzb2x2ZSBvbiBmaW5pc2hcblx0XHRcdFx0XHR3cml0ZVN0cmVhbS5vbignZmluaXNoJywgcmVzb2x2ZSk7XG5cblx0XHRcdFx0XHQvLyBjb3B5IHN0cmVhbVxuXHRcdFx0XHRcdHJlYWRTdHJlYW0ucGlwZSh3cml0ZVN0cmVhbSk7XG5cblx0XHRcdFx0XHRmdW5jdGlvbiBwcmVyZWplY3QoZXJyKSB7XG5cdFx0XHRcdFx0XHQvLyBkZXN0cm95IHN0cmVhbXNcblx0XHRcdFx0XHRcdHJlYWRTdHJlYW0uZGVzdHJveSgpO1xuXHRcdFx0XHRcdFx0d3JpdGVTdHJlYW0uZW5kKCk7XG5cblx0XHRcdFx0XHRcdC8vIHJlamVjdCB3aXRoIGVycm9yXG5cdFx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdClcblx0XHQpXG5cdH0sXG5cblx0Ly8gY29weUZpbGVTeW5jXG5cdHtcblx0XHRjb3B5RmlsZVN5bmM6IChzb3VyY2UsIHRhcmdldCkgPT4ge1xuXHRcdFx0Ly8gbWFrZSB0aGUgdGFyZ2V0IGRpcmVjdG9yeVxuXHRcdFx0ZXhwb3J0cy5ta2RpclN5bmMocGF0aC5kaXJuYW1lKHRhcmdldCkpO1xuXG5cdFx0XHQvLyBidWZmZXJcblx0XHRcdGNvbnN0IGJ1ZmZlckxlbmd0aCA9IDY0ICogMTAyNDtcblx0XHRcdGNvbnN0IGJ1ZmZlciA9IG5ldyBCdWZmZXIoYnVmZmVyTGVuZ3RoKTtcblxuXHRcdFx0Ly8gcG9zaXRpb25cblx0XHRcdGxldCBieXRlc1JlYWQgPSAxO1xuXHRcdFx0bGV0IHBvc2l0aW9uID0gMDtcblxuXHRcdFx0Ly8gb3BlbiB0aGUgcmVhZGVyIGFuZCB3cml0ZXJcblx0XHRcdGNvbnN0IHJlYWRlciA9IGZzLm9wZW5TeW5jKHNvdXJjZSwgJ3InKTtcblx0XHRcdGNvbnN0IHdyaXRlciA9IGZzLm9wZW5TeW5jKHRhcmdldCwgJ3cnKTtcblxuXHRcdFx0Ly8gY29weSB0aGUgZmlsZVxuXHRcdFx0d2hpbGUgKGJ5dGVzUmVhZCA+IDApIHtcblx0XHRcdFx0Ynl0ZXNSZWFkID0gZnMucmVhZFN5bmMocmVhZGVyLCBidWZmZXIsIDAsIGJ1ZmZlckxlbmd0aCwgcG9zaXRpb24pO1xuXG5cdFx0XHRcdGZzLndyaXRlU3luYyh3cml0ZXIsIGJ1ZmZlciwgMCwgYnl0ZXNSZWFkKTtcblxuXHRcdFx0XHRwb3NpdGlvbiArPSBieXRlc1JlYWQ7XG5cdFx0XHR9XG5cblx0XHRcdC8vIGNsb3NlIHRoZSByZWFkZXIgYW5kIHdyaXRlclxuXHRcdFx0ZnMuY2xvc2VTeW5jKHJlYWRlcik7XG5cdFx0XHRmcy5jbG9zZVN5bmMod3JpdGVyKTtcblx0XHR9XG5cdH0sXG5cblx0Ly8gcmVhZEpzb25cblx0e1xuXHRcdHJlYWRKc29uOiBmaWxlbmFtZSA9PiBleHBvcnRzLnJlYWRGaWxlKGZpbGVuYW1lLCAndXRmOCcpLnRoZW4oSlNPTi5wYXJzZSlcblx0fSxcblxuXHQvLyByZWFkSnNvblN5bmNcblx0e1xuXHRcdHJlYWRKc29uU3luYzogZmlsZW5hbWUgPT4gSlNPTi5wYXJzZShleHBvcnRzLnJlYWRGaWxlU3luYyhmaWxlbmFtZSwgJ3V0ZjgnKSlcblx0fSxcblxuXHQvLyBybWRpclxuXHR7XG5cdFx0cm1kaXI6IGRpcm5hbWUgPT4gbmV3IFByb21pc2UoXG5cdFx0XHQocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcdC8vIHJlbW92ZSB0aGUgZGlyZWN0b3J5XG5cdFx0XHRcdGZzLnJtZGlyKGRpcm5hbWUsXG5cdFx0XHRcdFx0ZXJyID0+IHtcblx0XHRcdFx0XHRcdC8vIGlmIHRoZXJlIGlzIGFuIGVycm9yIGFib3V0IHRoZSBkaXJlY3Rvcnkgbm90IGJlaW5nIGVtcHR5XG5cdFx0XHRcdFx0XHRpZiAoZXJyICYmIGVyci5jb2RlID09PSAnRU5PVEVNUFRZJykge1xuXHRcdFx0XHRcdFx0XHQvLyByZXNvbHZlIHRvIHJlYWQgdGhlIGRpcmVjdG9yeVxuXHRcdFx0XHRcdFx0XHRyZXNvbHZlKGV4cG9ydHMucmVhZGRpcihkaXJuYW1lKS50aGVuKFxuXHRcdFx0XHRcdFx0XHRcdC8vIHByb21pc2UgdG8gcmVtb3ZlIGVhY2ggY2hpbGQgb2YgdGhlIGRpcmVjdG9yeVxuXHRcdFx0XHRcdFx0XHRcdGNoaWxkcmVuID0+IFByb21pc2UuYWxsKFxuXHRcdFx0XHRcdFx0XHRcdFx0Y2hpbGRyZW4ubWFwKFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjaGlsZCA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Y29uc3QgcmVzb2x2ZWRDaGlsZCA9IHBhdGgucmVzb2x2ZShkaXJuYW1lLCBjaGlsZCk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBwcm9taXNlIHRvIHJlbW92ZSBvZiB0aGUgY2hpbGRcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZXhwb3J0cy5sc3RhdChyZXNvbHZlZENoaWxkKS50aGVuKFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0bHN0YXQgPT4gbHN0YXQuaXNEaXJlY3RvcnkoKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQ/IGV4cG9ydHMucm1kaXIocmVzb2x2ZWRDaGlsZClcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdDogZXhwb3J0cy51bmxpbmsocmVzb2x2ZWRDaGlsZClcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHQpXG5cdFx0XHRcdFx0XHRcdFx0KVxuXHRcdFx0XHRcdFx0XHQpLnRoZW4oXG5cdFx0XHRcdFx0XHRcdFx0Ly8gYW5kIHRoZW4gdHJ5IGFnYWluXG5cdFx0XHRcdFx0XHRcdFx0KCkgPT4gZXhwb3J0cy5ybWRpcihkaXJuYW1lKVxuXHRcdFx0XHRcdFx0XHQpKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdC8vIG90aGVyd2lzZSwgcmVqZWN0IGFueSBlcnJvclxuXHRcdFx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdC8vIG90aGVyd2lzZSwgcmVzb2x2ZVxuXHRcdFx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdClcblx0fSxcblxuXHQvLyBybWRpclN5bmNcblx0e1xuXHRcdHJtZGlyU3luYzogZGlybmFtZSA9PiB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHQvLyB0cnkgdG8gcmVtb3ZlIHRoZSBkaXJlY3Rvcnlcblx0XHRcdFx0ZnMucm1kaXJTeW5jKGRpcm5hbWUpO1xuXHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdC8vIGlmIHRoZXJlIGlzIGFuIGVycm9yIGFib3V0IHRoZSBkaXJlY3Rvcnkgbm90IGJlaW5nIGVtcHR5XG5cdFx0XHRcdGlmIChlcnIgJiYgZXJyLmNvZGUgPT09ICdFTk9URU1QVFknKSB7XG5cdFx0XHRcdFx0Y29uc3QgY2hpbGRyZW4gPSBleHBvcnRzLnJlYWRkaXJTeW5jKGRpcm5hbWUpO1xuXG5cdFx0XHRcdFx0Ly8gcmVtb3ZlIGVhY2ggY2hpbGQgb2YgdGhlIGRpcmVjdG9yeVxuXHRcdFx0XHRcdGNoaWxkcmVuLmZvckVhY2goXG5cdFx0XHRcdFx0XHRjaGlsZCA9PiB7XG5cdFx0XHRcdFx0XHRcdGNvbnN0IHJlc29sdmVkQ2hpbGQgPSBwYXRoLnJlc29sdmUoZGlybmFtZSwgY2hpbGQpO1xuXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGxzdGF0ID0gZXhwb3J0cy5sc3RhdFN5bmMocmVzb2x2ZWRDaGlsZCk7XG5cblx0XHRcdFx0XHRcdFx0Ly8gcmVtb3ZlIHRoZSBjaGlsZFxuXHRcdFx0XHRcdFx0XHRpZiAobHN0YXQuaXNEaXJlY3RvcnkoKSkge1xuXHRcdFx0XHRcdFx0XHRcdGV4cG9ydHMucm1kaXJTeW5jKHJlc29sdmVkQ2hpbGQpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdGV4cG9ydHMudW5saW5rU3luYyhyZXNvbHZlZENoaWxkKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdCk7XG5cblx0XHRcdFx0XHQvLyBhbmQgdGhlbiB0cnkgYWdhaW5cblx0XHRcdFx0XHRleHBvcnRzLnJtZGlyU3luYyhkaXJuYW1lKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyBvdGhlcndpc2UsIHRocm93IGFueSBlcnJvclxuXHRcdFx0XHRcdHRocm93IGVycjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fSxcblxuXHQvLyB0b3VjaEZpbGVcblx0e1xuXHRcdHRvdWNoRmlsZTogZmlsZW5hbWUgPT4gbmV3IFByb21pc2UoXG5cdFx0XHQocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcdC8vIHRvdWNoIHRoZSBmaWxlXG5cdFx0XHRcdGZzLm9wZW4oZmlsZW5hbWUsICd3eCcsXG5cdFx0XHRcdFx0KGVycikgPT4ge1xuXHRcdFx0XHRcdFx0Ly8gaWYgdGhlcmUgaXMgbm8gcGFyZW50IGRpcmVjdG9yeVxuXHRcdFx0XHRcdFx0aWYgKGVyciAmJiBlcnIuY29kZSA9PT0gJ0VOT0VOVCcpIHtcblx0XHRcdFx0XHRcdFx0Ly8gcHJvbWlzZSB0byBtYWtlIHRoZSBwYXJlbnQgZGlyZWN0b3J5XG5cdFx0XHRcdFx0XHRcdGV4cG9ydHMubWtkaXIocGF0aC5kaXJuYW1lKGZpbGVuYW1lKSkudGhlbihcblx0XHRcdFx0XHRcdFx0XHQvLyBhbmQgdGhlbiB0cnkgYWdhaW5cblx0XHRcdFx0XHRcdFx0XHQoKSA9PiBleHBvcnRzLnRvdWNoRmlsZShmaWxlbmFtZSlcblx0XHRcdFx0XHRcdFx0KS50aGVuKHJlc29sdmUpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChlcnIgJiYgZXJyLmNvZGUgIT09ICdFRVhJU1QnKSB7XG5cdFx0XHRcdFx0XHRcdC8vIG90aGVyd2lzZSwgcmVqZWN0IGFueSBlcnJvciBub3QgYWJvdXQgdGhlIGRpcmVjdG9yeSBhbHJlYWR5IGV4aXN0aW5nXG5cdFx0XHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Ly8gb3RoZXJ3aXNlLCByZXNvbHZlXG5cdFx0XHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0KVxuXHR9LFxuXG5cdC8vIHRvdWNoRmlsZVN5bmNcblx0e1xuXHRcdHRvdWNoRmlsZVN5bmM6IGZpbGVuYW1lID0+IHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdC8vIHRyeSB0byB0b3VjaCB0aGUgZmlsZVxuXHRcdFx0XHRmcy5vcGVuU3luYyhmaWxlbmFtZSwgJ3d4Jyk7XG5cdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0Ly8gaWYgdGhlcmUgaXMgbm8gcGFyZW50IGRpcmVjdG9yeVxuXHRcdFx0XHRpZiAoZXJyICYmIGVyci5jb2RlID09PSAnRU5PRU5UJykge1xuXHRcdFx0XHRcdC8vIG1ha2UgdGhlIHBhcmVudCBkaXJlY3Rvcnlcblx0XHRcdFx0XHRleHBvcnRzLm1rZGlyU3luYyhwYXRoLmRpcm5hbWUoZmlsZW5hbWUpKTtcblxuXHRcdFx0XHRcdC8vIGFuZCB0aGVuIHRyeSBhZ2FpblxuXHRcdFx0XHRcdGV4cG9ydHMudG91Y2hGaWxlU3luYyhmaWxlbmFtZSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoZXJyICYmIGVyci5jb2RlICE9PSAnRUVYSVNUJykge1xuXHRcdFx0XHRcdC8vIG90aGVyd2lzZSwgdGhyb3cgYW55IGVycm9yIG5vdCBhYm91dCB0aGUgZGlyZWN0b3J5IGFscmVhZHkgZXhpc3Rpbmdcblx0XHRcdFx0XHR0aHJvdyBlcnI7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cbik7XG4iXX0=